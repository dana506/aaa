#define _CRT_SECURE_NO_WARNINGS
#include "stdio.h"
#include "stdlib.h"
#include "string.h"
#include "memory.h"
//keyboad - stdin
//console - stdout
#define LINE_BUFFER 128
typedef struct Employee {
	short code;
	char* name;
	char* department;
	double salary;
}Employee;
//typedef struct Employee Employee;
typedef struct Node
{
	Employee* info;
	struct Node* pNext;
}Node;

/*functions' signatures for memory management*/
Employee* createInfo(short, char*, char*, double);
Node* createNode(Employee*);
/*functions' signatures for list operations*/
Node* insertHead(Node*, Employee*);
void insertTail(Node**, Employee*);
Node* insertListPos(Node*, Employee*, int);
void printList(Node*);
Node* deleteListPos(Node*, int);

void main()
{
	Node* list = NULL;
	FILE* pFile = fopen("Data.txt", "r");
	char lineBuffer[LINE_BUFFER], * token, sep_list[] = ",\n";
	Employee* emp = NULL;
	if (pFile)
	{
		while (fgets(lineBuffer, sizeof(lineBuffer), pFile))
		{
			emp = (Employee*)malloc(sizeof(Employee));
			//parsing the code
			token = strtok(lineBuffer, sep_list);
			emp->code = atoi(token);

			//parsing the name
			token = strtok(NULL, sep_list);
			emp->name = (char*)malloc(strlen(token) + 1);
			strcpy(emp->name, token);

			//parsing the dept
			token = strtok(NULL, sep_list);
			emp->department = (char*)malloc(strlen(token) + 1);
			strcpy(emp->department, token);

			//parsing the salary
			token = strtok(NULL, sep_list);
			emp->salary = atof(token);

			//insert into the list
			insertTail(&list, emp);
		}

		printList(list);

		Employee* e1 = createInfo(31000, "Badulescu Cristian", "Networking", 984.6);
		int pos = 431;
		list = insertListPos(list, e1, pos);
		printf("\n------------After position insert----------------\n");
		printList(list);
		pos = 10;
		list = deleteListPos(list, pos);
		printf("\n------------After position delete----------------\n");
		printList(list);

	}
}
Node* deleteListPos(Node* head, int pos)
{
	int index = 1;
	Node* aux = NULL;
	if (pos <= 1)
	{
		aux = head;
		head = head->pNext;
	}
	else
	{
		Node* tmp = head;
		while (tmp->pNext && index++ < pos - 1)
			tmp = tmp->pNext;
		if (tmp->pNext)
		{
			aux = tmp->pNext;
			tmp->pNext = aux->pNext;
		}
	}
	if (aux)
	{
		free(aux->info->department);
		free(aux->info->name);
		free(aux->info);
		free(aux);
	}
	return head;
}

Node* insertHead(Node* head, Employee* emp) {
	Node* newHead = createNode(emp);
	newHead->pNext = head;
	head = newHead;
	return head;
}
